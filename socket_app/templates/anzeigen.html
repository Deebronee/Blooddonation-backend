{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <!-- CSS only -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <link rel="stylesheet" href="{% static 'styles.css' %}">
        <script src="https://unpkg.com/vue@next"></script>
        <title>Testing Channels</title>
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-8 mx-auto mt-5">
                    <h3 class="mb-5">All appointments</h3>
                        <div id="app">           
                            <table class="table table-hover">
                                    <thead>
                                        <tr>
                                            <th scope="col">id</th>
                                            <th scope="col">date</th>
                                            <th scope="col">time</th>
                                            <th scope="col">last_name</th>
                                            <th scope="col">first_name</th>
                                            <th scope="col">reserved</th>
                                            <th scope="col">assigned</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="appointment in appointments" :key="appointment.id">
                                            <td class="align-middle">
                                                {{appointment.id}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.date}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.time}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.last_name}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.first_name}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.reserved}}
                                            </td>
                                            <td class="align-middle">
                                                {{appointment.assigned}}
                                            </td>
                                        </tr>
                                    </tbody>
                            </table>
                        </div> 
                </div>
            </div>
        <div>
    </body>
    <script>
        const { createApp } = Vue;

        const AppointmentApp = {
            data(){
                return {
                    appointment:'Just a Test'
                    appointments: null
                }
            },
            created(){
                const socket = new WebSocket('ws://${window.location.host}/ws/anzeigen')

                let _this = this;

                socket.onmessage = function(event) {
                    _this.appointments = JSON.parse(event.data);
                    console.log(_this.appointments);
                }
            }
        }

        createApp(AppointmentApp).mount('#app')
    </script>
</html>
